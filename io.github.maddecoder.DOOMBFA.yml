app-id: io.github.maddecoder.Classic-RBDOOM-3-BFG
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "21.08"
command: DOOMBFA.sh

finish-args:
- --device=all
- --socket=wayland
- --socket=fallback-x11
- --share=ipc
- --share=network
- --socket=pulseaudio
- --filesystem=~/.var/app:ro
- --filesystem=home
- --filesystem=/run/media
- --filesystem=/media

cleanup:
- /include
- /lib/*.a
- /lib/*.la
- /lib/pkgconfig
- /lib/debug

modules:
- name: DoomBFA
  buildsystem: cmake
  subdir: neo
  builddir: true
  no-make-install: true
  config-opts:
   - -DCMAKE_BUILD_TYPE=Retail
   - -DSDL2=ON
   - -DPACKAGED=ON
   - -DUSE_PRECOMPILED_HEADERS=OFF
   - -DMAKE_DLL=OFF
   - -DFFMPEG_AVCODEC_INCLUDE_DIR=/app/include
   - -DFFMPEG_LIBAVCODEC=/app/lib/libavcodec.so
   - -DFFMPEG_LIBAVFORMAT=/app/lib/libavformat.so
   - -DFFMPEG_LIBAVUTIL=/app/lib/libavutil.so
   - -DFFMPEG_LIBSWRESAMPLE=/app/lib/libswresample.so
   - -DFFMPEG_LIBSWSCALE=/app/lib/libswscale.so
   - -DOPENAL_FOUND=true
   - -DOPENAL_INCLUDE_DIR=/app/include
   - -DOPENAL_LIBRARY=/app/lib/libopenal.so
   - -DOPENAL_VERSION_STRING=1.22.0
   - -CMAKE_BUILD_PARALLEL_LEVEL=4
  sources:
  - type: git
    url: https://github.com/MadDeCoDeR/Classic-RBDOOM-3-BFG.git
  modules:
    - shared-modules/glew/glew.json
    - shared-modules/glu/glu-9.json
    - ffmpeg.json
    - openal.json
  build-commands:
    - install -Dm 755 DoomBFA /app/bin/DoomBFA

- name: DoomBFA-assets
  buildsystem: simple
  sources:
  - type: git
    url: https://github.com/MadDeCoDeR/Classic-RBDOOM-3-BFG.git
  - type: dir
    path: BFA_Assets
  - type: file
    path: io.github.maddecoder.Classic-RBDOOM-3-BFG.metainfo.xml
  - type: file
    path: DOOMBFA.desktop
  - type: file
    path: doom.png
  - type: file
    path: DOOMBFA.sh
  build-commands:
    - install -Dm 644 DOOMBFA.desktop /app/share/applications/${FLATPAK_ID}.desktop
    - install -Dm 644 doom.png /app/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png
    - mkdir -p /app/share/games/doombfa
    - cp -R base /app/share/games/doombfa/base
    - cp -R base_BFG/* /app/share/games/doombfa/base
    - install -Dm 644 io.github.maddecoder.Classic-RBDOOM-3-BFG.metainfo.xml /app/share/metainfo
    - install -Dm 755 DOOMBFA.sh /app/bin/DOOMBFA.sh
